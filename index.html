<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>자동 업데이트 데이터 현황 및 AI 예측</title>
    <!-- Chart.js 라이브러리 로드 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <style>
        /* 기본 스타일 설정 */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 20px; background-color: #f8f9fa; color: #212529; }
        .container { max-width: 1000px; margin: 0 auto; background-color: #ffffff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
        h1 { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-bottom: 25px; }
        h2 { color: #343a40; margin-top: 30px; margin-bottom: 15px; }
        .chart-container { margin-bottom: 40px; }
        
        /* 테이블 스타일 */
        table { width: 100%; max-width: 1000px; border-collapse: separate; border-spacing: 0; border: 1px solid #ddd; font-size: 14px; min-width: 300px; border-radius: 8px; overflow: hidden; margin-top: 20px; }
        thead th { padding: 14px; background-color: #f1f1f1; border-right: 1px solid #ccc; text-align: left; color: #333; }
        tbody td { padding: 12px; border-top: 1px solid #eee; border-right: 1px solid #eee; text-align: right; background-color: white; color: #343a40; }
        tbody tr:last-child td { border-bottom: none; }
        
        /* 변화량 색상 */
        .plus { color: #dc3545; font-weight: 600; } 
        .minus { color: #007bff; font-weight: 600; } 
        .zero { color: #6c757d; font-weight: 600; } 
        
        .first-col { text-align: left !important; color: #343a40; font-weight: normal; }
        .value-col { font-weight: bold; color: #333; }
        .right-align { text-align: right !important; }
        
        /* AI 예측 스타일 */
        .ai-box { white-space: pre-wrap; color: #007bff; font-weight: bold; padding: 15px; border: 1px dashed #007bff; border-radius: 6px; background-color: #f0f8ff; line-height: 1.6; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>자동 업데이트 데이터 차트 및 분석</h1>
        <p>최종 업데이트 시간: <span id="update-time">2025-11-01 22:13:08 KST</span></p>

        <div class="chart-container">
            <h2>데이터 추이 차트</h2>
            <canvas id="myChart"></canvas>
        </div>

        <div style="margin-bottom: 20px;">
            <h2>AI 예측 결과</h2>
            <div class="ai-box">이 게임은 출시 5일차(11월 1일) 오전부터 $3,216,000 이상의 누적 매출을 기록하며 매우 강력한 초기 실적을 보이고 있으며, 해당 일의 지속적인 매출 증가는 MMORPG 장르 특성상 건강하고 성공적인 출시 추세를 나타냅니다. 11월 1일 22:13 KST까지의 데이터와 최근 시간당 매출 증가율을 기반으로 예측할 때, 오늘(11월 1일) 자정(23:59:59 KST)까지의 총 누적 매출은 **$3,735,000**에 달할 것으로 예상됩니다.<br><br>현재 11월 1일의 일일 매출 추세가 유지된다고 가정하면, 약 $765,000의 일일 매출을 기준으로 11월 한 달간의 총 예상 매출은 **$22,950,000**로 예측됩니다.</div>
        </div>
        
        <h2>일별 요약 데이터</h2>
        <div id="daily-table-container">
            <tr><td colspan='3' style='text-align: center; color: #6c757d;'>데이터를 찾을 수 없습니다.</td></tr>
        </div>

        <h2 style="margin-top: 40px;">시간별 상세 데이터 (최근 30개 항목)</h2>
        <div id="hourly-table-container">
            <table class="data-table"><thead>    <tr>        <th class="header-col">시간</th>        <th class="header-col right-align">값</th>        <th class="header-col right-align">변화</th>    </tr></thead><tbody></tbody></table>
        </div>
        
        <script>
            // 쉘 스크립트에서 치환된 JSON 데이터 문자열을 로드합니다.
            const chartDataString = '{    "raw_data_string": "2025-11-01 07:43:10 KST : 3,216,000
2025-11-01 08:25:36 KST : 3,235,300
2025-11-01 10:02:47 KST : 3,280,000
2025-11-01 11:11:03 KST : 3,298,800
2025-11-01 14:30:00 KST : 3,388,600
2025-11-01 15:37:06 KST : 3,446,400
2025-11-01 16:56:10 KST : 3,475,700
2025-11-01 17:17:10 KST : 3,501,400
2025-11-01 18:27:55 KST : 3,545,100
2025-11-01 20:04:13 KST : 3,600,600
2025-11-01 20:10:32 KST : 3,600,600
2025-11-01 20:18:51 KST : 3,600,600
2025-11-01 20:22:54 KST : 3,600,600
2025-11-01 20:27:11 KST : 3,600,600
2025-11-01 20:31:29 KST : 3,600,600
2025-11-01 20:36:13 KST : 3,600,600
2025-11-01 20:45:21 KST : 3,600,600
2025-11-01 20:54:42 KST : 3,600,600
2025-11-01 21:01:23 KST : 3,626,900
2025-11-01 21:03:56 KST : 3,626,900
2025-11-01 21:07:20 KST : 3,626,900
2025-11-01 21:11:26 KST : 3,626,900
2025-11-01 21:18:52 KST : 3,626,900
2025-11-01 21:26:05 KST : 3,626,900
2025-11-01 21:29:30 KST : 3,626,900
2025-11-01 21:37:44 KST : 3,626,900
2025-11-01 21:48:40 KST : 3,626,900
2025-11-01 21:55:55 KST : 3,626,900
2025-11-01 22:06:47 KST : 3,673,900
2025-11-01 22:13:08 KST : 3,673,900",    "labels": [],    "values": []}';
            let dataSet = { labels: [], values: [] };

            try {
                // JSON 문자열을 파싱합니다.
                dataSet = JSON.parse(chartDataString);
            } catch (e) {
                console.error("Error parsing chart data JSON:", e);
                // 데이터 파싱 실패 시 기본값 사용
                dataSet = { 
                    labels: ["데이터 오류"], 
                    values: [0] ,
                    raw_data_string: chartDataString
                };
            }

            // Chart.js 설정
            const ctx = document.getElementById('myChart').getContext('2d');
            
            // 차트 데이터가 없거나 비어 있으면 경고를 표시하고 차트를 그리지 않습니다.
            if (!dataSet.labels || dataSet.labels.length === 0) {
                ctx.font = "16px sans-serif";
                ctx.textAlign = "center";
                ctx.fillText("차트 데이터를 불러올 수 없거나 데이터가 비어 있습니다.", ctx.canvas.width / 2, ctx.canvas.height / 2);
                console.warn("차트 데이터를 그릴 수 없습니다. 라벨 또는 값이 없습니다.");
                return;
            }

            // 차트 생성
            new Chart(ctx, {
                type: 'line',
                data: {
                    // 라벨에서 시간 부분(HH:MM)만 잘라서 표시
                    labels: dataSet.labels.map(label => label.substring(11, 16)), 
                    datasets: [{
                        label: '매출 추정치 ($)',
                        data: dataSet.values,
                        borderColor: '#007bff',
                        backgroundColor: 'rgba(0, 123, 255, 0.1)',
                        tension: 0.3, 
                        borderWidth: 2,
                        pointRadius: 3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false, 
                    layout: {
                        padding: { top: 10 }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                // 툴팁 통화 단위를 달러($)로 표시
                                label: function(context) {
                                    if (typeof context.parsed.y !== 'number' || isNaN(context.parsed.y)) {
                                        return context.dataset.label + ': ' + context.parsed.y;
                                    }
                                    return context.parsed.y.toLocaleString('en-US') + ' 달러($)'; 
                                },
                                title: function(context) {
                                    // 전체 시간 레이블 사용
                                    if (context.length > 0) {
                                        return dataSet.labels[context[0].dataIndex];
                                    }
                                    return '';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: '시간대' },
                            ticks: { maxRotation: 45, minRotation: 45 }
                        },
                        y: {
                            beginAtZero: false,
                            ticks: {
                                // Y축 통화 단위를 달러($)로 표시
                                callback: function(value) {
                                    return value.toLocaleString('en-US') + ' $';
                                }
                            },
                            title: { display: true, text: '매출 ($)' }
                        }
                    }
                }
            });
        </script>
    </div>
</body>
</html>


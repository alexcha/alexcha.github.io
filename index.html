<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>자동 업데이트 데이터 현황 및 AI 예측</title>
    <!-- Chart.js 라이브러리 로드 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <style>
        /* 기본 스타일 설정 */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 20px; background-color: #f8f9fa; color: #212529; }
        .container { max-width: 1000px; margin: 0 auto; background-color: #ffffff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
        h1 { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-bottom: 25px; }
        h2 { color: #343a40; margin-top: 30px; margin-bottom: 15px; }
        .chart-container { margin-bottom: 40px; }
        
        /* 테이블 스타일 */
        .data-table-wrapper { overflow-x: auto; }
        table { width: 100%; max-width: 1000px; border-collapse: separate; border-spacing: 0; border: 1px solid #ddd; font-size: 14px; min-width: 300px; border-radius: 8px; overflow: hidden; margin-top: 20px; }
        thead th { padding: 14px; background-color: #f1f1f1; border-right: 1px solid #ccc; text-align: left; color: #333; }
        tbody td { padding: 12px; border-top: 1px solid #eee; border-right: 1px solid #eee; text-align: right; background-color: white; color: #343a40; }
        tbody tr:last-child td { border-bottom: none; }
        
        /* 변화량 색상 */
        .plus { color: #dc3545; font-weight: 600; } 
        .minus { color: #007bff; font-weight: 600; } 
        .zero { color: #6c757d; font-weight: 600; } 
        
        .first-col { text-align: left !important; color: #343a40; font-weight: normal; }
        .value-col { font-weight: bold; color: #333; }
        .right-align { text-align: right !important; }
        
        /* AI 예측 스타일 */
        .ai-box { white-space: pre-wrap; color: #007bff; font-weight: bold; padding: 15px; border: 1px dashed #007bff; border-radius: 6px; background-color: #f0f8ff; line-height: 1.6; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>자동 업데이트 데이터 차트 및 분석</h1>
        <p>최종 업데이트 시간: <span id="update-time">2025-11-01 22:38:00 KST</span></p>

        <div class="chart-container">
            <h2>데이터 추이 차트 (최근 30개 항목)</h2>
            <canvas id="myChart"></canvas>
        </div>

        <div style="margin-bottom: 20px;">
            <h2>AI 예측 결과</h2>
            <div class="ai-box">초기 5일차(11월 1일)를 맞이한 게임은 견고한 매출 성장세를 보이고 있습니다. 11월 1일 오전 10시 2분경 누적 매출 $3,280,000를 기록한 이래 꾸준히 상승하여, 오후 10시 38분에는 $3,673,900에 도달했습니다. 이처럼 출시 5일차에도 지속적인 누적 매출 증가 추이를 보이는 것은 MMORPG 장르 특성상 초기 유저 유입 및 과금 성과가 양호하며 건강한 서비스 시작을 알리는 긍정적인 신호로 평가됩니다. 오늘(11월 1일) 하루 동안의 데이터 분석을 기반으로, 오늘 23시 59분 59초까지의 총 예상 누적 매출 규모는 약 $3,730,000로 예측됩니다.<br><br>현재까지의 강력한 매출 추이를 바탕으로 11월 전체 매출을 예측해 보았습니다. 11월 1일 하루 동안 약 $756,000의 매출이 발생한 것으로 추정되며, MMORPG의 일반적인 출시 초기 매출 하향 안정화 경향을 고려하여 남은 29일 동안은 일평균 $600,000의 매출을 기록할 것으로 예상됩니다. 이에 따라 11월 한 달간의 총 예상 매출은 $18,156,000로 전망됩니다.</div>
        </div>
        
        <h2>일별 요약 데이터</h2>
        <div id="daily-table-container" class="data-table-wrapper">
             <tr><td colspan='3' style='text-align: center; color: #6c757d;'>데이터를 찾을 수 없습니다.</td></tr>
        </div>

        <h2 style="margin-top: 40px;">시간별 상세 데이터 (최근 30개 항목)</h2>
        <div id="hourly-table-container" class="data-table-wrapper">
             <table class="data-table"><thead>    <tr>        <th class="header-col">시간</th>        <th class="header-col right-align">값</th>        <th class="header-col right-align">변화</th>    </tr></thead><tbody></tbody></table>
        </div>
        
        <script>
            // 쉘 스크립트에 의해 원시 데이터 문자열이 **직접** 삽입될 영역입니다.
            // **AWK에 의해 치환됩니다.**
            const RAW_DATA_CONTENT = `2025-10-30 22:40:45 KST : 2,170,400
2025-10-30 23:55:42 KST : 2,201,000
2025-10-31 00:13:31 KST : 2,234,700
2025-10-31 01:39:00 KST : 2,262,900
2025-10-31 02:35:25 KST : 2,260,800
2025-10-31 03:40:33 KST : 2,277,900
2025-10-31 04:23:41 KST : 2,294,800
2025-10-31 05:30:59 KST : 2,318,400
2025-10-31 06:03:38 KST : 2,339,900
2025-10-31 06:25:29 KST : 2,339,900
2025-10-31 07:29:41 KST : 2,361,700
2025-10-31 08:25:34 KST : 2,388,000
2025-10-31 10:51:59 KST : 2,463,300
2025-10-31 11:09:16 KST : 2,499,800
2025-10-31 12:50:56 KST : 2,532,300
2025-10-31 13:34:59 KST : 2,568,000
2025-10-31 14:30:56 KST : 2,648,400
2025-10-31 15:43:02 KST : 2,677,100
2025-10-31 16:27:07 KST : 2,666,900
2025-10-31 17:36:16 KST : 2,690,800
2025-10-31 18:30:51 KST : 2,708,200
2025-10-31 19:32:49 KST : 2,739,200
2025-10-31 20:24:04 KST : 2,769,600
2025-10-31 21:58:17 KST : 2,835,900
2025-10-31 22:39:15 KST : 2,848,500
2025-10-31 23:31:45 KST : 2,893,100
2025-11-01 00:30:13 KST : 2,925,600
2025-11-01 01:38:05 KST : 2,965,100
2025-11-01 02:28:21 KST : 3,039,400
2025-11-01 03:41:27 KST : 3,087,000
2025-11-01 04:23:18 KST : 3,150,300
2025-11-01 05:32:33 KST : 3,179,000
2025-11-01 06:09:05 KST : 3,201,000
2025-11-01 07:43:10 KST : 3,216,000
2025-11-01 08:25:36 KST : 3,235,300
2025-11-01 10:02:47 KST : 3,280,000
2025-11-01 11:11:03 KST : 3,298,800
2025-11-01 14:30:00 KST : 3,388,600
2025-11-01 15:37:06 KST : 3,446,400
2025-11-01 16:56:10 KST : 3,475,700
2025-11-01 17:17:10 KST : 3,501,400
2025-11-01 18:27:55 KST : 3,545,100
2025-11-01 20:04:13 KST : 3,600,600
2025-11-01 20:10:32 KST : 3,600,600
2025-11-01 20:18:51 KST : 3,600,600
2025-11-01 20:22:54 KST : 3,600,600
2025-11-01 20:27:11 KST : 3,600,600
2025-11-01 20:31:29 KST : 3,600,600
2025-11-01 20:36:13 KST : 3,600,600
2025-11-01 20:45:21 KST : 3,600,600
2025-11-01 20:54:42 KST : 3,600,600
2025-11-01 21:01:23 KST : 3,626,900
2025-11-01 21:03:56 KST : 3,626,900
2025-11-01 21:07:20 KST : 3,626,900
2025-11-01 21:11:26 KST : 3,626,900
2025-11-01 21:18:52 KST : 3,626,900
2025-11-01 21:26:05 KST : 3,626,900
2025-11-01 21:29:30 KST : 3,626,900
2025-11-01 21:37:44 KST : 3,626,900
2025-11-01 21:48:40 KST : 3,626,900
2025-11-01 21:55:55 KST : 3,626,900
2025-11-01 22:06:47 KST : 3,673,900
2025-11-01 22:13:08 KST : 3,673,900
2025-11-01 22:22:03 KST : 3,673,900
2025-11-01 22:38:00 KST : 3,673,900`;
            
            // 데이터 포맷팅 유틸리티 (천 단위 쉼표)
            function formatNumber(num) {
                if (typeof num !== 'number') return num; 
                return num.toLocaleString('en-US');
            }

            // 모든 데이터를 파싱하고 차트를 렌더링하는 메인 함수
            function processDataAndRender() {
                const rawData = RAW_DATA_CONTENT;

                // PLACEHOLDER가 그대로 남아 있다면 오류 메시지를 출력하고 종료
                if (rawData.includes("RAW_DATA_PLACEHOLDER_FOR_JS") || rawData.trim().length === 0) {
                    console.error("데이터 로드 실패: 쉘 스크립트가 PLACEHOLDER를 치환하지 못했습니다.");
                    
                    const errorMsg = "<p style='text-align: center; color: #dc3545; font-weight: bold;'>데이터 로드 오류: 스크립트 치환 실패. 쉘 스크립트를 확인하세요.</p>";
                    document.getElementById('daily-table-container').innerHTML = errorMsg;
                    document.getElementById('hourly-table-container').innerHTML = "";
                    
                    const ctx = document.getElementById('myChart').getContext('2d');
                    ctx.canvas.height = 300; 
                    ctx.font = "16px sans-serif";
                    ctx.textAlign = "center";
                    ctx.fillStyle = "#dc3545";
                    ctx.fillText("데이터 로드 실패: 스크립트 치환 오류", ctx.canvas.width / 2, ctx.canvas.height / 2);
                    return;
                }
                
                // 1. 데이터 파싱
                const lines = rawData.split('\n').filter(line => line.trim() !== '');
                const allData = []; 

                for (const line of lines) {
                    const parts = line.split(' : ');
                    if (parts.length === 2) {
                        const datetimeRaw = parts[0].trim();
                        const valueRaw = parts[1].trim().replace(/,/g, ''); 
                        const value = parseInt(valueRaw, 10);
                        
                        if (!isNaN(value)) {
                            const datePart = datetimeRaw.substring(0, 10); 
                            const timePart = datetimeRaw.substring(11, 16); 

                            allData.push({ 
                                datetime: datetimeRaw, 
                                value: value, 
                                date: datePart,
                                time: timePart
                            });
                        }
                    } 
                }
                
                // 차트 데이터 (최근 30개 항목만 사용)
                const chartData = allData.slice(-30);
                
                // 2. 차트 렌더링 (이전 HTML 파일의 renderChart 함수 로직과 동일)
                renderChart(chartData);
            }

            // 차트 렌더링 함수
            function renderChart(data) {
                const ctx = document.getElementById('myChart').getContext('2d');
                
                if (data.length === 0) {
                    ctx.canvas.height = 300; 
                    ctx.font = "16px sans-serif";
                    ctx.textAlign = "center";
                    ctx.fillStyle = "#6c757d";
                    ctx.fillText("차트 데이터를 불러올 수 없습니다. 데이터가 부족합니다.", ctx.canvas.width / 2, ctx.canvas.height / 2);
                    return;
                }

                const labels = data.map(d => d.datetime);
                const values = data.map(d => d.value);

                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.map(d => d.time), 
                        datasets: [{
                            label: '매출 추정치 ($)',
                            data: values,
                            borderColor: '#007bff',
                            backgroundColor: 'rgba(0, 123, 255, 0.1)',
                            tension: 0.3, 
                            borderWidth: 2,
                            pointRadius: 3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false, 
                        layout: { padding: { top: 10 } },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(context) { return formatNumber(context.parsed.y) + ' 달러($)'; },
                                    title: function(context) { return context.length > 0 ? labels[context[0].dataIndex] : ''; }
                                }
                            }
                        },
                        scales: {
                            x: { title: { display: true, text: '시간대' }, ticks: { maxRotation: 45, minRotation: 45 } },
                            y: {
                                beginAtZero: false,
                                ticks: { callback: function(value) { return formatNumber(value) + ' $'; } },
                                title: { display: true, text: '매출 ($)' }
                            }
                        }
                    }
                });
            }
            
            // 페이지 로드 시 데이터 처리 및 렌더링 시작
            processDataAndRender();
        </script>
    </div>
</body>
</html>


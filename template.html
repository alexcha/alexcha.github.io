<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>데이터 현황 및 AI 예측</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 20px; background-color: #f8f9fa; color: #212529; }
        .container { max-width: 1000px; margin: 0 auto; background-color: #ffffff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
        h1 { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-bottom: 25px; }
        h2 { color: #343a40; margin-top: 30px; margin-bottom: 15px; }
        .chart-container { margin-bottom: 40px; }
        /* 테이블 스타일 */
        table { width: 100%; max-width: 1000px; border-collapse: separate; border-spacing: 0; border: 1px solid #ddd; font-size: 14px; min-width: 300px; border-radius: 8px; overflow: hidden; margin-top: 20px; }
        thead th { padding: 14px; background-color: #f1f1f1; border-right: 1px solid #ccc; text-align: left; color: #333; }
        tbody td { padding: 12px; border-top: 1px solid #eee; border-right: 1px solid #eee; text-align: right; background-color: white; color: #343a40; }
        tbody tr:last-child td { border-bottom: none; }
        .plus { color: #dc3545; font-weight: 600; }
        .minus { color: #007bff; font-weight: 600; }
        .zero { color: #6c757d; font-weight: 600; }
        .first-col { text-align: left !important; color: #343a40; font-weight: normal; }
        .value-col { font-weight: bold; color: #333; }
        
        /* AI 예측 스타일 */
        .ai-box { white-space: pre-wrap; color: #007bff; font-weight: bold; padding: 15px; border: 1px dashed #007bff; border-radius: 6px; background-color: #f0f8ff; line-height: 1.6; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>자동 업데이트 데이터 차트 및 분석</h1>
        <p>최종 업데이트 시간: <span id="update-time"></span></p>

        <div class="chart-container">
            <h2>데이터 추이 차트</h2>
            <canvas id="myChart"></canvas>
        </div>

        <div style="margin-bottom: 20px;">
            <h2>AI 예측 결과</h2>
            <div class="ai-box">__AI_PREDICTION__</div>
        </div>
        
        <h2>일별 요약 데이터</h2>
        __DAILY_TABLE_HTML__

        <h2 style="margin-top: 40px;">시간별 상세 데이터</h2>
        __HOURLY_TABLE_HTML__
        
        <script>
            // 차트 데이터 삽입 (토큰 추가)
            const dataSet = JSON.parse('__CHART_DATA__');

            // 마지막 업데이트 시간 표시
            // 데이터셋 레이블에서 마지막 요소를 추출하여 업데이트 시간을 표시합니다.
            const lastDataPoint = dataSet.labels[dataSet.labels.length - 1];
            document.getElementById('update-time').textContent = lastDataPoint;

            // Chart.js 설정
            const ctx = document.getElementById('myChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: dataSet,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.y.toLocaleString() + ' 원';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString() + ' 원';
                                }
                            }
                        }
                    }
                }
            });
        </script>
    </div>
</body>
</html>
